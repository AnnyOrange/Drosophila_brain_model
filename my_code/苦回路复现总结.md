# 苦回路初步测试总结（LB2/LB4 苦相关 GRN）

- 环境：`conda run -n flybrain`，单核；`--n-run 2`（为缩短试次），频率 100 Hz。
- 输入选择：在注释表中筛选口器相关的 gustatory 类型，挑选与糖路不同的 LB2*/LB4a（共 26 个 root ID），但在 630 完整性表内仅有 10 个可用，其余缺失。
- 运行命令：
  ```bash
  conda run -n flybrain python my_code/bitter_circuit.py --freqs 100 --n-run 2 --n-proc 1 --path-res results/my_code_bitter --summary
  ```
- 输出文件：`results/my_code_bitter/bitterR_100Hz.parquet`。

## 结果概览（100 Hz，n_run=2）
- 高响应 Top10（Hz）：115.5, 107.5, 107.0, 104.5, 97.5, 97.0, 96.5, 92.5, 92.0, 90.5（均为 LB2/LB4 系的感受神经元，MxLbN）。
- MN9（口器运动神经元，CB0701/PhN）放电率：约 **18 Hz**。
- 对比糖路（同样 n_run=2、100 Hz，MN9 ≈ 65.5 Hz）：苦味输入对 MN9 的激活明显更弱，提示苦刺激下口器伸展驱动不显著。

## 1 秒窗口、5 次试验的 MN9 放电计数（快速对比）
- 脚本：`my_code/mn9_spike_hist.py`（t_run=1s，n_run=5，单核，输出到 `results/my_code_hist/`）。
- 每 trial 内 MN9 spikes（糖 vs 苦）：
  - 糖：`[81, 86, 78, 82, 90]`（总 417），均值 83.4，std 4.67。
  - 苦：`[9, 9, 11, 8, 9]`（总 46），均值 9.2，std 1.10。
- 直方图/柱状图：`mn9_sugar_hist.png`、`mn9_bitter_hist.png`、`mn9_sugar_trial_counts.png`、`mn9_bitter_trial_counts.png`（均在 `results/my_code_hist/`）。
- 结果：在相同 1 秒刺激下，糖路比苦路高出约 9 倍的 MN9 放电，显示苦刺激对口器输出的抑制/无效。

## 1 秒窗口、20 次试验的 MN9 放电计数
- 命令：  
  - 糖：`MPLCONFIGDIR=/tmp/mpl conda run -n flybrain python my_code/mn9_spike_hist.py --mode sugar --n-run 20`  
  - 苦：`MPLCONFIGDIR=/tmp/mpl conda run -n flybrain python my_code/mn9_spike_hist.py --mode bitter --n-run 20`
- 每 trial 内 MN9 spikes：  
  - 糖：`[94, 83, 84, 83, 81, 80, 85, 86, 83, 85, 89, 85, 93, 87, 81, 87, 76, 81, 90, 81]`（总 1694），均值 84.7，std 4.45。  
  - 苦：`[7, 13, 7, 10, 12, 17, 9, 8, 10, 9, 9, 6, 8, 12, 11, 12, 11, 11, 8, 9]`（总 199），均值 9.95，std 2.54。  
- 图表/CSV 同样生成在 `results/my_code_hist/`。  
- 结论：20 次重复下，糖路对 MN9 的激活依旧显著高于苦路（~8.5–9x），结论稳健。

## 注释来源
- `Supplemental_file1_neuron_annotations.tsv`：用于筛选 LB2/LB4（MxLbN，gustatory）以及确认 MN9（root_id `720575940660219265`, cell_type `CB0701`, nerve `PhN`, top_nt `acetylcholine`）。

## 后续建议
- 若需更稳定结果，去掉 `--n-run 2` 使用默认 n_run=30（时间更长）；如需并行可尝试 `--n-proc 2`（若受限则保持 1）。
- 可在 783 数据版本上复测：添加 `--path-comp Completeness_783.csv --path-con Connectivity_783.parquet`。
- 需要图表时先安装绘图依赖并设置可写缓存：
  ```bash
  conda run -n flybrain pip install matplotlib seaborn
  MPLCONFIGDIR=/tmp/mpl conda run -n flybrain python my_code/bitter_circuit.py --freqs 100 --n-run 2 --path-res results/my_code_bitter --summary
  ```
